spec:
  inputs:
    # Remember to update docs/reference/gitlab-ci-component.md
    branch:
      default: main
      description: "This branch is used as the target for releases."

    token:
      description: "GitLab token for creating and updating release MRs."

    extra-files:
      description: 'List of files that are scanned for version references.'
      default: ""

    stage:
      default: build
      description: 'Defines the build stage'
    # Remember to update docs/reference/gitlab-ci-component.md
---

releaser-pleaser:
  stage: $[[ inputs.stage ]]
  rules:
    # There is no way to run a pipeline when the MR description is updated :(
    - if: $CI_COMMIT_BRANCH == "$[[ inputs.branch ]]"
  image:
    name: ghcr.io/apricote/releaser-pleaser:v0.4.1 # x-releaser-pleaser-version
    entrypoint: [""]
  variables:
    GITLAB_TOKEN: $[[ inputs.token ]]
  script:
    - |
      rp run \
        --forge=gitlab \
        --branch=$[[ inputs.branch ]] \
        --extra-files="$[[ inputs.extra-files ]]"
